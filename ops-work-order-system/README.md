# 运维工单系统 (OPS Work Order System)

## 📋 项目简介

运维工单系统是一个基于Spring Boot开发的企业级运维管理平台，旨在简化和自动化IT运维流程，提高工作效率和服务质量。系统支持工单的全生命周期管理，包括创建、分配、处理、转派、审批和统计分析。

## 🎉 最新更新

- ✅ **工单类型管理系统** - 支持故障、需求、维护、应急四种工单类型
- ✅ **统计报表系统** - 完整的数据分析和可视化报表
- ✅ **部门层级管理** - 省市县三级部门结构管理
- ✅ **多层级审批工作流** - 可配置的复杂审批流程

## ✨ 核心功能

### 🎫 工单管理
- **工单创建**：支持多种工单类型创建，包含详细描述、优先级设置
- **工单分配**：自动或手动分配工单给相应负责人
- **状态管理**：完整的工单状态流转（待处理→已批准→处理中→已完成）
- **优先级管理**：紧急/高/中/低优先级分类，支持紧急工单处理
- **截止时间**：自动计算或手动设置工单截止时间
- **搜索过滤**：支持按状态、优先级、关键词等多维度筛选

### 🏷️ 工单类型管理 ⭐ **已完成**
- **故障工单**：系统故障、设备故障等紧急情况处理
- **需求工单**：新功能开发、系统优化等需求类工单
- **维护工单**：定期维护、系统更新等计划性工作
- **应急工单**：突发事件、安全事故等应急响应
- **类型配置**：可自定义工单类型的处理流程和时限
- **可视化对比**：工单类型特性对比和分析图表

### 🔄 转派管理
- **部门转派**：跨部门工单转派，支持专业化分工
- **用户转派**：精确转派给特定技术专家
- **协助请求**：请求其他人员协助处理，保持原负责人
- **转派历史**：完整的转派记录追踪和审计
- **权限控制**：基于角色的转派权限管理
- **实时通知**：转派状态变更实时通知相关人员

### 🏢 部门管理 ⭐ **已完成**
- **三级架构**：省级→市级→县级部门层级管理
- **联系人管理**：每个部门的负责人和联系方式
- **权限分配**：部门级别的权限控制和数据隔离
- **组织图表**：可视化的组织架构展示

### ⚡ 工作流管理 ⭐ **已完成**
- **多层级审批**：支持复杂的多级审批流程
- **并行审批**：同级多人并行审批，提高效率
- **串行审批**：逐级审批，确保流程严谨性
- **自动流转**：基于条件的自动流转机制
- **流程配置**：可视化的流程配置界面

### 📊 统计报表系统 ⭐ **刚完成！**

#### 📈 每日统计分析 (`/statistics/daily`)
- **汇总卡片**：总工单数、已完成数、平均完成率、统计天数
- **趋势图表**：使用Chart.js展示每日工单处理趋势
- **详细数据表格**：支持日期范围筛选和Excel导出
- **数据筛选**：按部门、状态、优先级等维度筛选

#### 📅 每周报表分析 (`/statistics/weekly`)
- **周统计卡片**：统计周数、总完成工单、平均完成率
- **双轴图表**：柱状图+折线图展示周度趋势
- **周详情卡片**：显示每日明细和完成情况
- **周期对比**：同比、环比分析功能

#### ⚠️ 超时预警监控 (`/statistics/overdue`)
- **分级预警统计**：轻微(1-12h)、严重(12-24h)、紧急(>24h)
- **超时工单列表**：按级别分组显示，包含处理建议
- **实时刷新**：每30秒自动更新数据
- **预警通知**：支持邮件和系统通知

#### 🏆 部门效率分析 (`/statistics/department-efficiency`)
- **效率排行榜**：冠亚季军显示，效率评级
- **双图表展示**：柱状图对比 + 饼图分布
- **综合评分**：基于完成率、及时率、处理速度、质量评分
- **效率优化建议**：AI分析提供改进建议

#### 📤 Excel导出功能
- **全功能导出**：所有统计页面都支持Excel导出
- **文件命名规范**：包含日期范围和类型标识
- **数据完整性**：导出数据与页面显示完全一致

### 👥 用户权限管理
- **角色管理**：管理员、经理、操作员等多级权限
- **部门管理**：组织架构管理，支持跨部门协作
- **用户管理**：完整的用户生命周期管理
- **权限控制**：细粒度的功能权限控制

## 🏗️ 技术架构

### 后端技术栈
- **Spring Boot 3.x** - 主框架
- **Spring Security** - 安全认证
- **Spring Data JPA** - 数据访问层
- **MySQL 8.0** - 关系型数据库
- **Flyway** - 数据库版本管理
- **Maven** - 项目构建管理

### 前端技术栈
- **Thymeleaf** - 模板引擎
- **Bootstrap 5** - UI框架
- **Bootstrap Icons** - 图标库
- **Chart.js** - 数据可视化图表
- **jQuery** - JavaScript库
- **AJAX** - 异步数据加载

### 架构特点
- **MVC架构**：清晰的分层架构设计
- **RESTful API**：标准的API设计规范
- **响应式设计**：支持多设备访问
- **模块化设计**：高内聚低耦合的模块结构

## 📊 项目进度清单

### 🔥 高优先级功能 (必须实现)

#### 1. 部门层级管理系统 ✅ （已完善）
- ✅ 省市县三级部门结构
- ✅ 部门联系人管理
- ✅ 部门权限分配

#### 2. 多层级审批工作流 ✅ (已完善)
- ✅ 可配置的审批流程
- ✅ 并行/串行审批支持
- ✅ 自动流转机制

#### 3. 统计报表系统 ✅ **（刚完成！）**
**已实现功能：**
- ✅ 每日工单流转统计 - 支持图表展示和详细数据表格
- ✅ 每周完成情况报表 - 周统计卡片和趋势分析
- ✅ 超时预警统计 - 分级预警监控和处理建议
- ✅ 部门效率分析 - 效率排行榜和对比图表
- ✅ Excel导出功能 - 所有报表支持Excel导出

#### 4. 工单类型管理 ✅ **（已完成！）**
**已实现功能：**
- ✅ 故障工单 - 系统故障、设备故障处理
- ✅ 需求工单 - 新功能开发、系统优化
- ✅ 维护工单 - 定期维护、系统更新
- ✅ 应急工单 - 突发事件、安全事故应急响应
- ✅ 类型配置管理 - 自定义处理流程和时限
- ✅ 可视化对比分析 - 类型特性对比图表

#### 5. 派单/转派功能 ❌ **（下一个目标）**
需要实现：
- 工单转派给其他部门
- 协助处理机制
- 转派历史记录
- 转派权限控制

### 🚀 中优先级功能

#### 6. 通知系统 ❌
- 邮件通知
- 短信通知
- 系统内通知
- 通知模板管理

#### 7. 文件附件系统 ❌
- 文件上传下载
- 附件管理
- 文件预览
- 存储优化

#### 8. 工单模板系统 ❌
- 模板创建管理
- 快速创建工单
- 模板分类
- 模板权限控制

### 📱 移动端支持
#### 9. 手机APP门户 ❌
- 移动端适配
- APP开发
- 推送通知
- 离线功能

### ⚙️ 系统增强功能
#### 10. 系统配置管理 ❌
#### 11. 操作日志审计 ❌
#### 12. 数据导出功能 ❌
#### 13. 权限精细化控制 ❌

## ⚡ 性能优化

### 数据库优化
- **索引优化**：15+个针对性复合索引，覆盖所有常用查询场景
- **查询优化**：使用JOIN FETCH避免N+1查询问题
- **分页查询**：大数据量场景下的分页处理
- **批量操作**：减少数据库交互次数

### 应用层优化
- **异步处理**：使用CompletableFuture并行处理
- **懒加载**：按需加载数据，减少内存占用
- **缓存策略**：静态数据缓存，提高响应速度
- **连接池**：数据库连接池优化

### 前端优化
- **AJAX懒加载**：动态加载用户和部门数据
- **前端缓存**：减少重复API调用
- **响应式UI**：优化用户体验
- **资源压缩**：CSS/JS资源优化

## 📊 数据库设计

### 核心表结构
```sql
-- 工单表
work_orders
├── id (主键)
├── title (标题)
├── description (描述)
├── status (状态)
├── priority (优先级)
├── type (工单类型) ⭐ 新增
├── created_by_id (创建人)
├── assigned_to_id (分配给)
├── created_at (创建时间)
├── deadline (截止时间)
└── updated_at (更新时间)

-- 工单类型表 ⭐ 新增
work_order_types
├── id (主键)
├── name (类型名称)
├── display_name (显示名称)
├── description (描述)
├── icon (图标)
├── color_code (颜色代码)
├── default_priority (默认优先级)
├── default_deadline_hours (默认截止时间)
├── requires_approval (是否需要审批)
├── requires_immediate (是否紧急处理)
└── created_at (创建时间)

-- 转派记录表
transfer_records
├── id (主键)
├── work_order_id (工单ID)
├── transfer_type (转派类型)
├── from_user_id (源用户)
├── to_user_id (目标用户)
├── from_department_id (源部门)
├── to_department_id (目标部门)
├── requested_by_id (申请人)
├── accepted_by_id (接受人)
├── status (转派状态)
├── transfer_reason (转派原因)
├── is_assistance (是否协助)
├── requested_at (申请时间)
├── accepted_at (接受时间)
└── completed_at (完成时间)

-- 用户表
users
├── id (主键)
├── username (用户名)
├── password (密码)
├── email (邮箱)
├── role (角色)
├── department_id (部门ID)
└── created_at (创建时间)

-- 部门表 (三级架构)
departments
├── id (主键)
├── name (部门名称)
├── description (描述)
├── level (层级：PROVINCE/CITY/COUNTY)
├── parent_id (上级部门ID)
├── contact_person (联系人)
├── contact_phone (联系电话)
├── contact_email (联系邮箱)
└── created_at (创建时间)
```

### 索引优化策略
```sql
-- 统计报表核心索引
idx_work_orders_created_at_status          -- 时间+状态统计
idx_work_orders_department_created_at      -- 部门效率分析
idx_work_orders_type_priority_created_at   -- 类型优先级分析
idx_work_orders_deadline_status            -- 超时预警查询

-- 转派记录核心索引
idx_transfer_records_status_to_user_created_at  -- 用户待处理查询
idx_transfer_records_status_to_dept_created_at  -- 部门待处理查询
idx_transfer_records_work_order_created_at      -- 工单历史查询

-- 工单表核心索引
idx_work_orders_status              -- 状态查询
idx_work_orders_assigned_to         -- 分配人查询
idx_work_orders_created_at          -- 时间排序
```

## 🚀 快速开始

### 环境要求
- Java 17+
- MySQL 8.0+
- Maven 3.8+

### 安装步骤

1. **克隆项目**
```bash
git clone [项目地址]
cd ops-work-order-system
```

2. **配置数据库**
```bash
# 创建数据库
mysql -u root -p
CREATE DATABASE ops_work_order_system;
```

3. **修改配置文件**
```yaml
# application.properties
spring.datasource.url=jdbc:mysql://localhost:3306/ops_work_order_system
spring.datasource.username=your_username
spring.datasource.password=your_password
```

4. **运行应用**
```bash
mvn clean compile
mvn spring-boot:run
```

5. **访问系统**
- 地址：http://localhost:8080
- 默认账号：admin/admin

## 👤 默认用户

| 用户名 | 密码 | 角色 | 说明 |
|--------|------|------|------|
| admin | admin | ADMIN | 系统管理员 |
| manager | password | MANAGER | 部门经理 |
| operator | password | OPERATOR | 操作员 |

## 🎯 下一步计划

**🚀 近期目标：派单/转派功能**
- 实现工单转派给其他部门
- 添加协助处理机制
- 完善转派历史记录
- 实现转派权限控制

建议优先实现工单转派功能，这是工单流转的重要环节！

## 📞 技术支持

如有问题或建议，请联系开发团队。

---

**📊 项目统计：** 已完成 5/13 个核心功能模块 (38% 完成度)
**🎉 最新成就：** 统计报表系统和工单类型管理已全部完成！ 